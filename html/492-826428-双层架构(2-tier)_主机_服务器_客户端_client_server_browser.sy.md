---
show: step
version: 1.0
enable_checker: true
---

# 双层架构
## 我们来回顾一下 😌

- 最初的计算都在一个机器上进行
	- 自身对于自身进行反馈
	- 反馈分成两种
		- 正反馈(容易失控)
		- 负反馈(稳定在平衡位置)
- 下面这个就是1-tier架构
	- 纯纯的模拟电路

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651726915855)

- 如果规模化之后	
	- 一般都要控制很多传感器和水泵
	- 又要怎么办呢？🤔

### 保湿

- 每个大棚都有湿度传感器
- 而且位置是分散的
- 传回到数据会交给一个程序

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651726480650)

- 程序进行判断
	- 如果湿度不够就浇水
	- 如果湿度够了就停止
	- 不能旱的旱死涝旳涝死
- 具体哪个
	- 滴灌设备浇水
	- 浇多少水
	- 都是由服务器决定的
- 这就是2-tier架构

### Host

- 一个主机(Host)可以
	- 有多个终端(terminal)和他相连

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20230429-1682766155830)

- 这种主机-终端的模式被保留了下来

### 网吧游戏

- 所有人不可能都在 
	- 同一个电脑上打游戏
		- 这就需要都连接到主机

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220519-1652931093478)

- 有人建主机(Host)
	- 然后等待玩家加入
	- 等待的玩家算是客(client)
	- 客到了加入了主机建立的游戏
	- 才能玩游戏

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220519-1652930765716)

- 后来链接的协议从局域网的ipx
	- 进化到了英特网的tcp/ip

### 服务器

- 大家都连接到某个ip的服务器
	- 然后一起玩游戏
	- 这其实就分出了两端
		- 前端
		- 后端

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651721298317)

- 那前后端各管什么呢？
- 先说说
	- 前端或者说客户端管什么？

### 前端

- 游戏的
	- 图形界面
	- 峡谷场景模型
	- 英雄皮肤
	- 动作数据
	- 魔法效果
	- 语音包

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651724450462)

- 这些看得见、听得着的东西
- 更新客户端
	- 就是从服务器上下载这些看得见、听得着的东西
	- 就可以看到新的模型、动作和特效
- 那后端管什么呢？

### 后端

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651724754077)

- 后端或者说服务端管什么
	- 对玩家的奖惩
	- 拉新促活的活动
	- 对战双方的匹配
	- 铭文的装备
	- 技能的具体数值

### 卡顿

- 如果游戏过程中把网给断了
	- wifi、5g 都断了

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220515-1652621228834)

- 比如你放了一个大
	- 由于网断了
		- 所以无法上传到服务器
		- 服务器也就无法更新你的数据
- 服务器一直在运行
	- 那九个人还在玩
- 你
	- 不但没有放出大
	- 而且已经死了
	- 根本连不上去了

### 更新

- 运行游戏之前
	- 需要更新

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651724292725)

- 有各种各样的资源包
	- 这些都要下载到手机前端(客户端)
	- 更新的是手机存储器上的app
	- 这种属于热更新
	- 服务器不用停机重启
- 那什么东西放在后端呢？

### 核心数据

- 对于你所拥有的英雄
	- 都放在后端

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651725280922)

- 如果要对核心的程序结构更新
	- 比如加入一个防沉迷系统
	- 会发生什么呢？
- 只在前端变化或者后端调整都不行
	- 要一起更新这个比较大的补丁(防沉迷)
	- 会发生什么呢？

### 先测试

- 让部分玩家下载体验服对应的客户端
	- 测试客户端连接到测试服务期
	- 有新的内容和业务逻辑
	- 玩的过程进行反馈
	- 调整解决问题到最终发布版

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651725608053)

- 等待最终发布

### 停服更新

- 把服务器停下来(冷更新)
	- 用新代码编译后的结果替代旧代码
	- 服务器就更新了

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651725302964)

- 所有人进入客户端的时候
	- 更新到新版客户端
- 这样服务器和客户端就都更新了
	- 这种C/S架构是internet的基础
- 随着时间的推移
	- 出现了一种新的客户端

### 浏览器

- 原来每种客户端都有自己的用途
	- 游戏客户端
	- 邮件客户端
	- 视频app客户端

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651727397152)

- 但是浏览器什么都能做
	- 玩游戏
	- 收发网页
	- 看视频
- 甚至可以
	- 微信网页版聊天

- 那这种浏览器
	- 相对于客户端 有什么好处么？

### VS

- 客户端能干的事情浏览器都能干
- 而且他还不用下载或者更新客户端
- 直接就能用起来 

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220505-1651727646995)

- 浏览器(browser)本质上也是一个客户端(client)
- 浏览器(browser)是一个网页查看客户端
- 也是2-tier架构
- 分成前后两端

### 划分

- 后端
	- 优点是浏览器看不见，保密性好
	- 数据敏感度、安全性高的放在后端安全
- 前端
	- 优点是在浏览器上就直接计算
	- 数据响应时间敏感度高的就在前端
	- 比如一个浏览器的动画效果
		- 没有必要再去服务器走个来回
	- UI交互相关度较高也都放到前端
	- 还是那些看得见听得着的东西
- 这种划分也就造成了前后端工程师侧重的不同

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211114-1636897719334)

- 双方都有什么看家本事呢？

### 前端 vs 后端

- 前端工程师
	- html、css、javascript
	- 注重美术、设计
	- 注重前端交互技术
	- 考虑怎样能让用户觉得用起来更舒服
	- 考虑界面布局、交互效果、页面加载速度
	- 主要是偏向用户看得见的部分
	- 客户端（pc、手机、pad）上浏览web

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211114-1636898000231)

- 后端工程师
	- java、python、go等后端语言
	- 后端的应用服务器比如tomcat
	- 通过语言访问后台数据库
	- 管的是用户看不到的部分
	- 想办法让服务速度更快
		- 考虑业务逻辑
		- 数据库表结构设计
		- 服务器配置
		- 负载均衡
		- 数据的存储
		- 跨平台API设计
- 可以从整体上分析么？

### 整体

- 前后端有不同的技术
	- 各自都很厉害

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220515-1652620801694)

- 中间使用网络通信协议连接起来 
	- 需要彼此配合

### 回归

- 今天我们可以看到前后端技术如此不同

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211114-1636898102314)

- 但是也不要忘了回到当初
	- 我们把计算机使用网络连接了起来
	- 人为地区分出
		- 主机(host)和终端(terminal)
		- 服务器(server)和客户端(client)
		- 乃至到今天的
			- 服务器(server)和浏览器(browser)
- 一分为二很容易
	- 难的是合二为一

### 总结

- 只有两端都了解
	- 才能促进中间接口的进化

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211114-1636898021424)

- 前端也可以计算
- 后端也可以计算
- 那究竟
	- 计算放在 哪里好呢？
- 比如 我想要计算
	- 1到100的和
- 前后端 分别会 如何处理 呢？🤔
- 下次再说👋🏻