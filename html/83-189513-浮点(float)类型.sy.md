---
show: step
version: 1.0
enable_checker: true
---

# 浮点类型

## 回忆

- 上次观察余数细节
- 有三种取整方法
  - 向上天花板
  - 向下地板
  - 四舍五入
- 整除取余数用的都是向下地板法
- 如果不用整除的话，会如何呢？
- 不用整除的话，商很可能是一个小数
- 那这小数到底是怎么使用的呢？🤪

## 小数细节

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629446578924)

- 小数使用基本上是 ok 的

### 观察

- 观察数据类型

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629446662095)

- 小数叫做fractions
	- 破碎的
	- 和整体的integer相反 
- 什么是 float 呢？
- help(float)

### 浮点类型 float

- float原意是浮动
- 这里的浮动指的是小数点可以浮动

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211029-1635515488500)

- float 类里面有个成员函数 hex
- 注意help(float.hex)才能找到
	- 找的是float类里面的hex函数
	- 而不是`__builtins__`里面的内置的hex函数 


### 二进制形态

- float的东西是point
	- 浮动的对象是小数点

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629446954069)

- p 的意思是小数点 point
- p 前面的是有效数字
  - 可以有正负号
  - $0x$ 说明是 16 进制的表示法
- p 后面是指数
  - 小数点浮动位置
  - $-4$ 就是左移 4 位
  - $+1$ 就是右移 1 位
  - 指数变化会造成数量级的翻番
    - 在 2 的底数基础上翻番
- 因为小数点 point 可以浮动 float
  - 所以这种类型叫做浮点数 floating-point number

### 特别注意

- float 是一个类的名字
- 最好不要用他作为变量名
- 因为
  - 一旦 float 作为一个变量理解
  - 就不能使用 float 函数把字符串转化为浮点型了

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210829-1630200328957)

- 这个原理和 str、int 等类一样
  - 而且浮点型变量的精度要低于整型变量
  - 这听起来很难以置信
  - 我们来看看

## 精度问题

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211003-1633222609130)

- 真的发生了
  - 浮点型数字精度低于整型数字
- 为什么呢？

  - 单精度浮点型数字只有 4 个字节
  - 双精度浮点型数字有 8 个字节
  - 有效数字位数有限
  - 所以...

- 浮点型数字被截断了...
  - 最上面的图可以看出丢失了一位精度
  - 而且最后一位 9 还给舍了
- 具体是怎么截断的呢？

### 验证

- 我们先看看最简单的1是如何存储的

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629447597089)

- $1.0$ 对应 `\x3f\x80\x00\x00`
	- 这个规则叫做 ieee754 32-bit 浮点数规则
- 存储在四个字节
	- "$>f$"为什么可以把二进制形态改变？

### 1.0的存储

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220308-1646725113755)

- 这种表示法就像我们的科学计数法
	- 3e8
	- 相当于3*10<sup>8</sup>
- exponent 指数部分
	- 平衡位置在01111111
	- 指数部分的加减
		- 负责让数字翻倍或折半
		- 让数字可以表达的范围增大
- mantissa 尾数部分
	- 在前面默认加了一个1
	- 负责数字的有效数字位数
	- 从而确保提高数字的精度
	- 具体的数字都是默认的1之后的小数点后的部分

- http://www.binaryconvert.com/result_float.html?hexadecimal=3F800000

## 继续验证

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220308-1646725740719)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629447904479)

- $2.0$ 和 $1.0$ 相比
  - 指数部分 $+1$
  - 尾数部分没有变化

### **$4.0$：**

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220308-1646733947511)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629448017365)

- $4.0$ 和 $2.0$ 相比
  - 原基础上又 $x2$
  - 相当于指数 $+1$
  - 尾数没有变化
- 如果是 $0.5$ 呢？

### **$0.5$：**

- $0.5$ 是在 $1.0$ 的基础上除以 2
- 相当于在 $1.0$ 的指数部分 $-1$

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220308-1646737762598)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629448317994)

- 指数部分从 $1.0$ 的 `\x3f\x80` 到 $0.5$ 的 `\x3f\x00`

### 尾数部分

- 尾数怎么用呢？
- 回到 $1.0$
- 然后观察 $1.5$

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629448678597)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220308-1646737975921)

- $1.5$ 和 $1.0$ 相比
  - 指数没有变化
  - 尾数把第一位改成了 1
- $(1.1)$ <sub>2</sub> 等于 $(1.5)$<sub>10</sub>

### 3

- $3.0$ 和 $1.5$ 相比
  - 尾数没有变化
  - 指数 $+1$
  - 相当于乘以 $2$

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629448861896)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220308-1646738153003)

## 负数呢

- $-3.0$ 和 $3.0$ 相比
  - 指数和尾数都没有变化
  - 符号位从 $0$ 变 $1$
  - 意味着这是负数

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220308-1646738269862)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629448962448)

- 请自己练习


### 练习


![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220308-1646738330134)

- 这个 -5 应该如何理解

### 回到最初

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220731-1659258628034)

- 这个过程也就是
	- 123456789123456789被截取精度的过程
	- 必须要落实到8字节双浮点型的过程

### 浮点数总结

- 浮点数有三个部分组成
  - 符号位
    - 负责正负
    - $0$ 就是正
    - $1$ 就是负
  - 指数部分
    - 负责翻倍
    - 以 $01111111$ 为平衡位置
    - $+1$ 相当于乘以 $2$
    - $-1$ 相当于除以 $2$
  - 尾数部分
    - 前面有一个 $1$ 不显示
    - 默认就是 $1.0$
    - 第一位写一个 $1$ 代表 $1.1$
    - 第二位再写一个 $1$ 代表 $1.11$
- 那我们回来再看看 $0.1$
	- 有的时候也会出现无法理解的情况

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629446614955)

- 这出现了误差？！🤪
- 下次再说 👋
